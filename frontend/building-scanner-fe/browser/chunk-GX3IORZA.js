import{a as Z}from"./chunk-36WBY4FB.js";import{a as J}from"./chunk-CKMCQKPL.js";import{a as X,b as ee}from"./chunk-TASIOQSO.js";import{a as W}from"./chunk-SDNWGHGT.js";import{b as H}from"./chunk-LFHDXIOD.js";import"./chunk-YOCH7QLI.js";import{d as K,k as Q}from"./chunk-ROWYVCHC.js";import{a as O}from"./chunk-VM4A2UPN.js";import{b as q,d as z}from"./chunk-SWCQFAKF.js";import{a as h}from"./chunk-YCQLNCBZ.js";import{a as G}from"./chunk-VQMHI6YC.js";import"./chunk-VPUI5ZKM.js";import{Bb as L,Cb as U,Da as m,Ga as d,Ha as A,I as M,Ia as r,Ja as a,Jb as Y,Ka as f,N as w,Oa as v,Pa as P,Qa as b,S,T as E,Va as g,W as R,Xa as l,ab as T,bb as D,cb as c,da as C,db as _,ea as x,eb as $,j as I,ja as k,lb as V,ta as s,ua as u,vb as j,w as y,wb as F,x as B,xb as N}from"./chunk-ADDNN3XJ.js";var te=(()=>{let n=class n extends G{constructor(t){super(t),this.http=t}getMessages(t){return this.httpGetRequest("/messages",{building_id:t})}sendMessage(t,o){return this.httpPostRequest("/messages",{building_id:t,text:o})}};n.\u0275fac=function(o){return new(o||n)(S(Y))},n.\u0275prov=w({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();var ge=i=>({visited:i});function de(i,n){i&1&&(r(0,"span",10),g(1,"visited"),a())}function le(i,n){if(i&1){let e=v();r(0,"div",12)(1,"app-sb-button",13),P("buttonClicked",function(){C(e);let o=b(2);return x(o.visitBuilding())}),a()()}i&2&&(s(),d("buttonText","Visit building"))}function pe(i,n){if(i&1){let e=v();r(0,"div",12)(1,"app-sb-button",13),P("buttonClicked",function(){C(e);let o=b(2);return x(o.deleteBuilding())}),a()()}i&2&&(s(),d("buttonText","Delete building"))}function ue(i,n){if(i&1&&(r(0,"div",8)(1,"h2",4),g(2),m(3,de,2,0,"span",9),a(),r(4,"p",10)(5,"strong"),g(6,"Location:"),a(),f(7,"br"),g(8),f(9,"br"),g(10),a(),r(11,"p",10)(12,"strong"),g(13,"Description:"),a(),g(14),a(),r(15,"p",10)(16,"strong"),g(17,"Owner:"),a(),g(18),a(),m(19,le,2,1,"div",11),c(20,"async"),m(21,pe,2,1,"div",11),c(22,"async"),c(23,"async"),a()),i&2){let e=b();d("ngClass",D(15,ge,e.building==null?null:e.building.visited)),s(2),l(" ",e.building==null?null:e.building.name," "),s(),d("ngIf",e.building==null?null:e.building.visited),s(5),l(" Latitude: ",e.building==null?null:e.building.location.latitude," "),s(2),l(" Longitude: ",e.building==null?null:e.building.location.longitude," "),s(4),l(" ",e.building==null?null:e.building.description,""),s(4),l(" ",e.building==null?null:e.building.created_by.username,""),s(),d("ngIf",!(e.building!=null&&e.building.visited)&&_(20,9,e.userInfo$).role!==e.userRoles.ADMIN),s(2),d("ngIf",_(22,11,e.userInfo$).role===e.userRoles.ADMIN&&e.building.created_by.id===_(23,13,e.userInfo$).id)}}function ce(i,n){if(i&1&&(r(0,"div",14),c(1,"async"),r(2,"strong"),g(3),c(4,"async"),a(),g(5),c(6,"date"),f(7,"br"),g(8),a()),i&2){let e=n.$implicit,t=b();A("user-message",_(1,5,t.userInfo$).id===e.user.id),s(3),l(" ",_(4,7,t.userInfo$).id===e.user.id?"You":e.user.username," "),s(2),l(" ",$(6,9,e.created_at,"shortTime")," "),s(3),l(" ",e.text," ")}}function me(i,n){if(i&1){let e=v();r(0,"div",15)(1,"div",16),f(2,"app-sb-input",17),a(),r(3,"div",18)(4,"app-sb-button",13),P("buttonClicked",function(){C(e);let o=b();return x(o.sendMessage())}),a()()()}if(i&2){let e=b();s(2),d("control",e.newMessage)("placeholder","Send your message..."),s(2),d("buttonText","Send message")}}var Ae=(()=>{let n=class n{constructor(t,o,p,ie,ne,oe,se){this.buildingsAPI=t,this.messagesAPI=o,this.visitsAPI=p,this.userInfoService=ie,this.route=ne,this.router=oe,this.cdRef=se,this.destroyRef$=E(k),this.buildingId=null,this.newMessage=new K(""),this.messages=[],this.userInfo$=this.userInfoService.userInfo.asObservable(),this.userRoles=X}ngOnInit(){this.route.paramMap.pipe(h(this.destroyRef$),y(t=>!!t.get("id")),M(t=>(this.buildingId=Number(t.get("id")),this.getBuildingInfo(this.buildingId).pipe(B(o=>(o.error.statusCode===404&&this.router.navigate([O.buildings_page.routerPath]),I)),M(o=>(this.building=o,this.getBuildingMessages())))))).subscribe(t=>{this.messages=t,this.cdRef.detectChanges()})}getBuildingInfo(t){return this.buildingsAPI.getBuilding(t)}sendMessage(){this.newMessage.value.trim().length>0&&this.messagesAPI.sendMessage(this.buildingId,this.newMessage.value).pipe(h(this.destroyRef$)).subscribe(t=>{this.newMessage.setValue(""),this.messages.push(t),this.cdRef.detectChanges()})}getBuildingMessages(){return this.messagesAPI.getMessages(this.buildingId)}visitBuilding(){this.visitsAPI.visitBuilding(this.buildingId).pipe(h(this.destroyRef$)).subscribe(t=>{this.building.visited=!0,this.cdRef.detectChanges()})}deleteBuilding(){this.buildingsAPI.deleteBuilding(this.buildingId).pipe(h(this.destroyRef$)).subscribe(t=>{this.router.navigate([O.buildings_page])})}};n.\u0275fac=function(o){return new(o||n)(u(J),u(te),u(Z),u(ee),u(q),u(z),u(V))},n.\u0275cmp=R({type:n,selectors:[["app-building-page"]],standalone:!0,features:[T],decls:10,vars:5,consts:[[1,"building-page"],[1,"container"],["class","building-item","style","margin-bottom: 48px",3,"ngClass",4,"ngIf"],[1,"chat-section"],[1,"heading-2"],[1,"chat-container"],["class","message medium",3,"user-message",4,"ngFor","ngForOf"],["class","chat-input",4,"ngIf"],[1,"building-item",2,"margin-bottom","48px",3,"ngClass"],["class","medium",4,"ngIf"],[1,"medium"],["class","building-item__button",4,"ngIf"],[1,"building-item__button"],[3,"buttonClicked","buttonText"],[1,"message","medium"],[1,"chat-input"],[1,"chat-input__input"],[3,"control","placeholder"],[1,"chat-input__button"]],template:function(o,p){o&1&&(r(0,"div",0)(1,"div",1),m(2,ue,24,17,"div",2),r(3,"div",3)(4,"h2",4),g(5,"Chat about this building"),a(),r(6,"div",5),m(7,ce,9,12,"div",6),a(),m(8,me,5,3,"div",7),c(9,"async"),a()()()),o&2&&(s(2),d("ngIf",p.building),s(5),d("ngForOf",p.messages),s(),d("ngIf",(p.building==null?null:p.building.visited)||_(9,3,p.userInfo$).role===p.userRoles.ADMIN))},dependencies:[Q,H,W,F,N,j,U,L],styles:[".building-page[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.building-page[_ngcontent-%COMP%]   .building-details[_ngcontent-%COMP%]{padding:40px 20px}.building-page[_ngcontent-%COMP%]   .building-details[_ngcontent-%COMP%]   .heading-1[_ngcontent-%COMP%]{margin-bottom:20px;font-size:2.5em}.building-page[_ngcontent-%COMP%]   .building-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:10px;font-size:1.2em}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]{flex-grow:1;border-radius:4px;padding:40px 20px;background-color:#9c8ef7}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;padding:20px;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;margin-bottom:20px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-bottom:10px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .message.user-message[_ngcontent-%COMP%]{text-align:end}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-input[_ngcontent-%COMP%]{display:flex;gap:10px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-input__input[_ngcontent-%COMP%]{flex:1}",".heading-1[_ngcontent-%COMP%]{font:700 24px/24px Poppins,sans-serif}.heading-2[_ngcontent-%COMP%]{font:600 20px/20px Poppins,sans-serif}.heading-3[_ngcontent-%COMP%]{font:700 16px/16px Poppins,sans-serif}.medium[_ngcontent-%COMP%]{font:400 12px/12px Poppins,sans-serif}.medium-small[_ngcontent-%COMP%]{font:400 10px/10px Poppins,sans-serif}.button-text[_ngcontent-%COMP%]{font:600 16px/16px Poppins,sans-serif}.building-page[_ngcontent-%COMP%]{padding:20px;height:100%;background-color:#f8f9fb;color:#151515;overflow-y:hidden}.building-page__title[_ngcontent-%COMP%]{margin-bottom:24px}.building-page[_ngcontent-%COMP%]   .building-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;overflow-y:auto;max-height:100%;padding-bottom:60px}.building-page[_ngcontent-%COMP%]   .building-list[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px #0000001a;transition:transform .3s,box-shadow .3s}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 4px 8px #0003}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{cursor:default}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:10px}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:8px}.building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]{background-color:#fff;color:#000;border:2px solid #695FE4}.building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]   .visit-button[_ngcontent-%COMP%]{background-color:#695fe4}.building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]   .visit-button[_ngcontent-%COMP%]:hover, .building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]   .visit-button[_ngcontent-%COMP%]:active{background-color:#ffe}"],changeDetection:0});let i=n;return i})();export{Ae as BuildingPageComponent};
