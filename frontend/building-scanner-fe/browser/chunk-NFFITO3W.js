import{a as Z}from"./chunk-36WBY4FB.js";import{a as J}from"./chunk-CKMCQKPL.js";import{a as X,b as ee}from"./chunk-TASIOQSO.js";import{a as W}from"./chunk-SDNWGHGT.js";import{b as H}from"./chunk-LFHDXIOD.js";import"./chunk-YOCH7QLI.js";import{d as K,k as Q}from"./chunk-ROWYVCHC.js";import{a as z}from"./chunk-VM4A2UPN.js";import{b as Y,d as q}from"./chunk-SWCQFAKF.js";import{a as h}from"./chunk-YCQLNCBZ.js";import{a as G}from"./chunk-VQMHI6YC.js";import"./chunk-VPUI5ZKM.js";import{Bb as N,Cb as L,Da as u,Ga as d,Ha as k,I as C,Ia as g,Ja as s,Jb as U,Ka as f,N as w,Oa as v,Pa as M,Qa as m,S,T as B,Va as r,W as E,Xa as l,ab as A,bb as T,cb as b,da as x,db as _,ea as P,eb as j,j as O,ja as R,lb as D,ta as a,ua as c,vb as F,w as I,wb as $,x as y,xb as V}from"./chunk-ADDNN3XJ.js";var te=(()=>{let i=class i extends G{constructor(t){super(t),this.http=t}getMessages(t){return this.httpGetRequest("/messages",{building_id:t})}sendMessage(t,o){return this.httpPostRequest("/messages",{building_id:t,text:o})}};i.\u0275fac=function(o){return new(o||i)(S(U))},i.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var re=n=>({visited:n});function de(n,i){n&1&&(g(0,"span",10),r(1,"visited"),s())}function le(n,i){if(n&1){let e=v();g(0,"div",12)(1,"app-sb-button",13),M("buttonClicked",function(){x(e);let o=m(2);return P(o.visitBuilding())}),s()()}n&2&&(a(),d("buttonText","Visit building"))}function pe(n,i){if(n&1&&(g(0,"div",8)(1,"h2",4),r(2),u(3,de,2,0,"span",9),s(),g(4,"p",10)(5,"strong"),r(6,"Location:"),s(),f(7,"br"),r(8),f(9,"br"),r(10),s(),g(11,"p",10)(12,"strong"),r(13,"Description:"),s(),r(14),s(),g(15,"p",10)(16,"strong"),r(17,"Owner:"),s(),r(18),s(),u(19,le,2,1,"div",11),b(20,"async"),s()),n&2){let e=m();d("ngClass",T(10,re,e.building==null?null:e.building.visited)),a(2),l(" ",e.building==null?null:e.building.name," "),a(),d("ngIf",e.building==null?null:e.building.visited),a(5),l(" Latitude: ",e.building==null?null:e.building.location.latitude," "),a(2),l(" Longitude: ",e.building==null?null:e.building.location.longitude," "),a(4),l(" ",e.building==null?null:e.building.description,""),a(4),l(" ",e.building==null?null:e.building.created_by.username,""),a(),d("ngIf",!(e.building!=null&&e.building.visited)&&_(20,8,e.userInfo$).role!==e.userRoles.ADMIN)}}function ce(n,i){if(n&1&&(g(0,"div",14),b(1,"async"),g(2,"strong"),r(3),b(4,"async"),s(),r(5),b(6,"date"),f(7,"br"),r(8),s()),n&2){let e=i.$implicit,t=m();k("user-message",_(1,5,t.userInfo$).id===e.user.id),a(3),l(" ",_(4,7,t.userInfo$).id===e.user.id?"You":e.user.username," "),a(2),l(" ",j(6,9,e.created_at,"hh:mm")," "),a(3),l(" ",e.text," ")}}function ue(n,i){if(n&1){let e=v();g(0,"div",15)(1,"div",16),f(2,"app-sb-input",17),s(),g(3,"div",18)(4,"app-sb-button",13),M("buttonClicked",function(){x(e);let o=m();return P(o.sendMessage())}),s()()()}if(n&2){let e=m();a(2),d("control",e.newMessage)("placeholder","Send your message..."),a(2),d("buttonText","Send message")}}var ke=(()=>{let i=class i{constructor(t,o,p,ne,ie,oe,se){this.buildingsAPI=t,this.messagesAPI=o,this.visitsAPI=p,this.userInfoService=ne,this.route=ie,this.router=oe,this.cdRef=se,this.destroyRef$=B(R),this.buildingId=null,this.newMessage=new K(""),this.messages=[],this.userInfo$=this.userInfoService.userInfo.asObservable(),this.userRoles=X}ngOnInit(){this.route.paramMap.pipe(h(this.destroyRef$),I(t=>!!t.get("id")),C(t=>(this.buildingId=Number(t.get("id")),this.getBuildingInfo(this.buildingId).pipe(y(o=>(o.error.statusCode===404&&this.router.navigate([z.buildings_page.routerPath]),O)),C(o=>(this.building=o,this.getBuildingMessages())))))).subscribe(t=>{this.messages=t,this.cdRef.detectChanges()})}getBuildingInfo(t){return this.buildingsAPI.getBuilding(t)}sendMessage(){this.newMessage.value.trim().length>0&&this.messagesAPI.sendMessage(this.buildingId,this.newMessage.value).pipe(h(this.destroyRef$)).subscribe(t=>{this.newMessage.setValue(""),this.messages.push(t),this.cdRef.detectChanges()})}getBuildingMessages(){return this.messagesAPI.getMessages(this.buildingId)}visitBuilding(){this.visitsAPI.visitBuilding(this.buildingId).pipe(h(this.destroyRef$)).subscribe(t=>{this.building.visited=!0,this.cdRef.detectChanges()})}};i.\u0275fac=function(o){return new(o||i)(c(J),c(te),c(Z),c(ee),c(Y),c(q),c(D))},i.\u0275cmp=E({type:i,selectors:[["app-building-page"]],standalone:!0,features:[A],decls:10,vars:5,consts:[[1,"building-page"],[1,"container"],["class","building-item","style","margin-bottom: 48px",3,"ngClass",4,"ngIf"],[1,"chat-section"],[1,"heading-2"],[1,"chat-container"],["class","message medium",3,"user-message",4,"ngFor","ngForOf"],["class","chat-input",4,"ngIf"],[1,"building-item",2,"margin-bottom","48px",3,"ngClass"],["class","medium",4,"ngIf"],[1,"medium"],["class","building-item__button",4,"ngIf"],[1,"building-item__button"],[3,"buttonClicked","buttonText"],[1,"message","medium"],[1,"chat-input"],[1,"chat-input__input"],[3,"control","placeholder"],[1,"chat-input__button"]],template:function(o,p){o&1&&(g(0,"div",0)(1,"div",1),u(2,pe,21,12,"div",2),g(3,"div",3)(4,"h2",4),r(5,"Chat about this building"),s(),g(6,"div",5),u(7,ce,9,12,"div",6),s(),u(8,ue,5,3,"div",7),b(9,"async"),s()()()),o&2&&(a(2),d("ngIf",p.building),a(5),d("ngForOf",p.messages),a(),d("ngIf",(p.building==null?null:p.building.visited)||_(9,3,p.userInfo$).role===p.userRoles.ADMIN))},dependencies:[Q,H,W,$,V,F,L,N],styles:[".building-page[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.building-page[_ngcontent-%COMP%]   .building-details[_ngcontent-%COMP%]{padding:40px 20px}.building-page[_ngcontent-%COMP%]   .building-details[_ngcontent-%COMP%]   .heading-1[_ngcontent-%COMP%]{margin-bottom:20px;font-size:2.5em}.building-page[_ngcontent-%COMP%]   .building-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:10px;font-size:1.2em}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]{flex-grow:1;border-radius:4px;padding:40px 20px;background-color:#9c8ef7}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;padding:20px;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;margin-bottom:20px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-bottom:10px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .message.user-message[_ngcontent-%COMP%]{text-align:end}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-input[_ngcontent-%COMP%]{display:flex;gap:10px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-input__input[_ngcontent-%COMP%]{flex:1}",".heading-1[_ngcontent-%COMP%]{font:700 24px/24px Poppins,sans-serif}.heading-2[_ngcontent-%COMP%]{font:600 20px/20px Poppins,sans-serif}.heading-3[_ngcontent-%COMP%]{font:700 16px/16px Poppins,sans-serif}.medium[_ngcontent-%COMP%]{font:400 12px/12px Poppins,sans-serif}.medium-small[_ngcontent-%COMP%]{font:400 10px/10px Poppins,sans-serif}.button-text[_ngcontent-%COMP%]{font:600 16px/16px Poppins,sans-serif}.building-page[_ngcontent-%COMP%]{padding:20px;height:100%;background-color:#f8f9fb;color:#151515;overflow-y:hidden}.building-page__title[_ngcontent-%COMP%]{margin-bottom:24px}.building-page[_ngcontent-%COMP%]   .building-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;overflow-y:auto;max-height:100%;padding-bottom:60px}.building-page[_ngcontent-%COMP%]   .building-list[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px #0000001a;transition:transform .3s,box-shadow .3s}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 4px 8px #0003}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{cursor:default}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:10px}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:8px}.building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]{background-color:#fff;color:#000;border:2px solid #695FE4}.building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]   .visit-button[_ngcontent-%COMP%]{background-color:#695fe4}.building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]   .visit-button[_ngcontent-%COMP%]:hover, .building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]   .visit-button[_ngcontent-%COMP%]:active{background-color:#ffe}"],changeDetection:0});let n=i;return n})();export{ke as BuildingPageComponent};
