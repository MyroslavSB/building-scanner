import{a as X}from"./chunk-J2GCNGBT.js";import{a as J}from"./chunk-FEBFEGKT.js";import{b as Z}from"./chunk-TASIOQSO.js";import{a as W}from"./chunk-SDNWGHGT.js";import{b as U}from"./chunk-LFHDXIOD.js";import"./chunk-YOCH7QLI.js";import{d as K,k as Q}from"./chunk-ROWYVCHC.js";import{a as H}from"./chunk-VM4A2UPN.js";import{b as q,d as z}from"./chunk-SWCQFAKF.js";import{a as f}from"./chunk-YCQLNCBZ.js";import{a as G}from"./chunk-ZUABGXMI.js";import"./chunk-VPUI5ZKM.js";import{Bb as N,Cb as L,Da as u,Ga as d,Ha as R,I as h,Ia as g,Ja as s,Jb as Y,Ka as b,N as w,Oa as P,Pa as v,Qa as m,S,T as B,Va as r,W as E,Xa as l,ab as A,bb as T,cb as _,da as C,db as M,ea as x,eb as j,j as O,ja as k,lb as F,ta as a,ua as c,vb as D,w as I,wb as V,x as y,xb as $}from"./chunk-ADDNN3XJ.js";var tt=(()=>{let i=class i extends G{constructor(e){super(e),this.http=e}getMessages(e){return this.httpGetRequest("/messages",{building_id:e})}sendMessage(e,o){return this.httpPostRequest("/messages",{building_id:e,text:o})}};i.\u0275fac=function(o){return new(o||i)(S(Y))},i.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var gt=n=>({visited:n});function rt(n,i){n&1&&(g(0,"span",10),r(1,"visited"),s())}function dt(n,i){if(n&1){let t=P();g(0,"div",12)(1,"app-sb-button",13),v("buttonClicked",function(){C(t);let o=m(2);return x(o.visitBuilding())}),s()()}n&2&&(a(),d("buttonText","Visit building"))}function lt(n,i){if(n&1&&(g(0,"div",8)(1,"h2",4),r(2),u(3,rt,2,0,"span",9),s(),g(4,"p",10)(5,"strong"),r(6,"Location:"),s(),b(7,"br"),r(8),b(9,"br"),r(10),s(),g(11,"p",10)(12,"strong"),r(13,"Description:"),s(),r(14),s(),g(15,"p",10)(16,"strong"),r(17,"Owner:"),s(),r(18),s(),u(19,dt,2,1,"div",11),s()),n&2){let t=m();d("ngClass",T(8,gt,t.building==null?null:t.building.visited)),a(2),l(" ",t.building==null?null:t.building.name," "),a(),d("ngIf",t.building==null?null:t.building.visited),a(5),l(" Latitude: ",t.building==null?null:t.building.location.latitude," "),a(2),l(" Longitude: ",t.building==null?null:t.building.location.longitude," "),a(4),l(" ",t.building==null?null:t.building.description,""),a(4),l(" ",t.building==null?null:t.building.created_by.username,""),a(),d("ngIf",!(t.building!=null&&t.building.visited))}}function ct(n,i){if(n&1&&(g(0,"div",14),_(1,"async"),g(2,"strong"),r(3),_(4,"async"),s(),r(5),_(6,"date"),b(7,"br"),r(8),s()),n&2){let t=i.$implicit,e=m();R("user-message",M(1,5,e.userInfo$).id===t.user.id),a(3),l(" ",M(4,7,e.userInfo$).id===t.user.id?"You":t.user.username," "),a(2),l(" ",j(6,9,t.created_at,"hh:mm")," "),a(3),l(" ",t.text," ")}}function pt(n,i){if(n&1){let t=P();g(0,"div",15)(1,"div",16),b(2,"app-sb-input",17),s(),g(3,"div",18)(4,"app-sb-button",13),v("buttonClicked",function(){C(t);let o=m();return x(o.sendMessage())}),s()()()}if(n&2){let t=m();a(2),d("control",t.newMessage)("placeholder","Send your message..."),a(2),d("buttonText","Send message")}}var Et=(()=>{let i=class i{constructor(e,o,p,et,nt,it,ot){this.buildingsAPI=e,this.messagesAPI=o,this.visitsAPI=p,this.userInfoService=et,this.route=nt,this.router=it,this.cdRef=ot,this.destroyRef$=B(k),this.buildingId=null,this.newMessage=new K(""),this.messages=[],this.userInfo$=this.userInfoService.userInfo.asObservable()}ngOnInit(){this.route.paramMap.pipe(f(this.destroyRef$),I(e=>!!e.get("id")),h(e=>(this.buildingId=Number(e.get("id")),this.getBuildingInfo(this.buildingId).pipe(y(o=>(o.error.statusCode===404&&this.router.navigate([H.buildings_page.routerPath]),O)),h(o=>(this.building=o,this.getBuildingMessages())))))).subscribe(e=>{this.messages=e,this.cdRef.detectChanges()})}getBuildingInfo(e){return this.buildingsAPI.getBuilding(e)}sendMessage(){this.newMessage.value.trim().length>0&&this.messagesAPI.sendMessage(this.buildingId,this.newMessage.value).pipe(f(this.destroyRef$)).subscribe(e=>{this.newMessage.setValue(""),this.messages.push(e),this.cdRef.detectChanges()})}getBuildingMessages(){return this.messagesAPI.getMessages(this.buildingId)}visitBuilding(){this.visitsAPI.visitBuilding(this.buildingId).pipe(f(this.destroyRef$)).subscribe(e=>{this.building.visited=!0,this.cdRef.detectChanges()})}};i.\u0275fac=function(o){return new(o||i)(c(J),c(tt),c(X),c(Z),c(q),c(z),c(F))},i.\u0275cmp=E({type:i,selectors:[["app-building-page"]],standalone:!0,features:[A],decls:9,vars:3,consts:[[1,"building-page"],[1,"container"],["class","building-item","style","margin-bottom: 48px",3,"ngClass",4,"ngIf"],[1,"chat-section"],[1,"heading-2"],[1,"chat-container"],["class","message medium",3,"user-message",4,"ngFor","ngForOf"],["class","chat-input",4,"ngIf"],[1,"building-item",2,"margin-bottom","48px",3,"ngClass"],["class","medium",4,"ngIf"],[1,"medium"],["class","building-item__button",4,"ngIf"],[1,"building-item__button"],[3,"buttonClicked","buttonText"],[1,"message","medium"],[1,"chat-input"],[1,"chat-input__input"],[3,"control","placeholder"],[1,"chat-input__button"]],template:function(o,p){o&1&&(g(0,"div",0)(1,"div",1),u(2,lt,20,10,"div",2),g(3,"div",3)(4,"h2",4),r(5,"Chat about this building"),s(),g(6,"div",5),u(7,ct,9,12,"div",6),s(),u(8,pt,5,3,"div",7),s()()()),o&2&&(a(2),d("ngIf",p.building),a(5),d("ngForOf",p.messages),a(),d("ngIf",p.building==null?null:p.building.visited))},dependencies:[Q,U,W,V,$,D,L,N],styles:[".building-page[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.building-page[_ngcontent-%COMP%]   .building-details[_ngcontent-%COMP%]{padding:40px 20px}.building-page[_ngcontent-%COMP%]   .building-details[_ngcontent-%COMP%]   .heading-1[_ngcontent-%COMP%]{margin-bottom:20px;font-size:2.5em}.building-page[_ngcontent-%COMP%]   .building-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:10px;font-size:1.2em}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]{flex-grow:1;border-radius:4px;padding:40px 20px;background-color:#9c8ef7}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;padding:20px;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;margin-bottom:20px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-bottom:10px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .message.user-message[_ngcontent-%COMP%]{text-align:end}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-input[_ngcontent-%COMP%]{display:flex;gap:10px}.building-page[_ngcontent-%COMP%]   .chat-section[_ngcontent-%COMP%]   .chat-input__input[_ngcontent-%COMP%]{flex:1}",".heading-1[_ngcontent-%COMP%]{font:700 24px/24px Poppins,sans-serif}.heading-2[_ngcontent-%COMP%]{font:600 20px/20px Poppins,sans-serif}.heading-3[_ngcontent-%COMP%]{font:700 16px/16px Poppins,sans-serif}.medium[_ngcontent-%COMP%]{font:400 12px/12px Poppins,sans-serif}.medium-small[_ngcontent-%COMP%]{font:400 10px/10px Poppins,sans-serif}.button-text[_ngcontent-%COMP%]{font:600 16px/16px Poppins,sans-serif}.building-page[_ngcontent-%COMP%]{padding:20px;height:100%;background-color:#f8f9fb;color:#151515;overflow-y:hidden}.building-page__title[_ngcontent-%COMP%]{margin-bottom:24px}.building-page[_ngcontent-%COMP%]   .building-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;overflow-y:auto;max-height:100%;padding-bottom:60px}.building-page[_ngcontent-%COMP%]   .building-list[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px #0000001a;transition:transform .3s,box-shadow .3s}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 4px 8px #0003}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{cursor:default}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:10px}.building-page[_ngcontent-%COMP%]   .building-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:8px}.building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]{background-color:#fff;color:#000;border:2px solid #695FE4}.building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]   .visit-button[_ngcontent-%COMP%]{background-color:#695fe4}.building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]   .visit-button[_ngcontent-%COMP%]:hover, .building-page[_ngcontent-%COMP%]   .building-item.visited[_ngcontent-%COMP%]   .visit-button[_ngcontent-%COMP%]:active{background-color:#ffe}"],changeDetection:0});let n=i;return n})();export{Et as BuildingPageComponent};
